<include file="Public:header" />

	<link rel="stylesheet" href="/public/js/jquery_theme/base/jquery.ui.all.css">
	<script src="/public/js/jquery_ui/jquery.ui.core.js"></script>
	<script src="/public/js/jquery_ui/jquery.ui.widget.js"></script>
	<script src="/public/js/jquery_ui/jquery.ui.datepicker.js"></script>
	<div class="panel">
		<div align="left">
			
			<fieldset class="fieldset">
			<legend>查询条件</legend>
			       用户昵称：<span style="color:red">{$userinfo.nickname}</span>&nbsp;&nbsp;
                   <form action="__ACTION__"  method="post">
                        用户ID:<input type="text"  name="userid"  value="{$Think.request.userid}">&nbsp;
                        类型:<select name="type">
                        <option value="1"
                           <eq name="Think.request.type" value='1'>selected</eq>
                        >被关注</option>
                        <option value="2"
                            <eq name="Think.request.type" value='2'>selected</eq>
                        >关注</option>
                        </select><br><br>
                        <input type="submit" name="submit"  value="查询">&nbsp;&nbsp;&nbsp;
                        <input type="button" name="add_fans" value="加粉丝"  id="add_fans">
                   </form>
			</fieldset>
			
		</div>
	</div>
<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0">
  <tr>
    <td height="30"><table width="100%" border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td width="15" height="30"><img src="__PUBLIC__/images/tab_03.gif" width="15" height="30" /></td>
        <td width="281" background="__PUBLIC__/images/tab_05.gif"><img src="__PUBLIC__/images/311.gif" width="16" height="16" /> <span class="STYLE4">粉丝管理</span></td>
        <td width="1101" background="__PUBLIC__/images/tab_05.gif" align="right">{$page}</td>
        <td width="14"><img src="/siteadmin/Public/images/tab_07.gif" width="14" height="30" /></td>
      </tr>
    </table></td>
  </tr>
  <tr>
    <td><table width="100%" border="0" cellspacing="0" cellpadding="0" id="showdata">
      <tr>
        <td width="9" background="__PUBLIC__/images/tab_12.gif">&nbsp;</td>
        <td bgcolor="#f3ffe3">
        <form name="orderlist" id="orderlist" >
        <table width="99%" border="0" align="center" cellpadding="0" cellspacing="1" bgcolor="#c0de98">
          <tr background="__PUBLIC__/images/tab_14.gif">
            <td width="3%" height="26"><div align="center" class="STYLE2 STYLE1">全选</div></td>
            <td width="5%" height="26"><div align="center" class="STYLE2 STYLE1">用户ID</div></td>
            <td width="10%" height="18"><div align="center" class="STYLE2 STYLE1">用户名</div></td>
            <td width="8%" height="18"><div align="center" class="STYLE2 STYLE1">呢称</div></td>
            <td width="8%" height="18"><div align="center" class="STYLE2 STYLE1">联系人</div></td>
            <td width="8%" height="18"><div align="center" class="STYLE2 STYLE1">手机</div></td>
            <td width="18%" height="18"><div align="center" class="STYLE2 STYLE1">地址</div></td>
            <td width="5%" height="18"><div align="center" class="STYLE2">邮编</div></td>
            <td width="5%" height="18"><div align="center" class="STYLE2">关注数</div></td>
            <td width="5%" height="18"><div align="center" class="STYLE2">粉丝数</div></td>  
            <td width="15%" height="18"><div align="center" class="STYLE2">注册时间</div></td>
          </tr>
          <volist name="userlist" id="userlist" empty="暂时没有匹配的数据" key="k">
          <tr height="30px">
            <td bgcolor="#FFFFFF" height="18"><input type="checkbox" value="{$userlist.userid}"  id="listcheckbox" name="listcheckbox[]" ></td>
            <td bgcolor="#FFFFFF" height="18"><div align="left" class="STYLE2 STYLE1"><a href="/space/{$userlist[userid]}" target="_blank">{$userlist[userid]}</a></div></td>
            <td bgcolor="#FFFFFF" height="18" class="STYLE2"><div align="center" class="STYLE2 STYLE1">{$userlist[usermail]}</div></td>
            <td bgcolor="#FFFFFF" height="18">{$userlist[nickname]}</td>
            <td bgcolor="#FFFFFF" height="18"><div align="left" class="STYLE2 STYLE1">{$userlist[linkman]|default="***"}</div></td>
            <td bgcolor="#FFFFFF" height="18"><div align="left" class="STYLE2 STYLE1">{$userlist[telphone]|default="***"}</div></td>
            <td bgcolor="#FFFFFF" height="18"><div align="left" class="STYLE2 STYLE1">{$userlist[province]|default="***"}{$userlist[city]}{$userlist[address]}</div></td>
            <td bgcolor="#FFFFFF" height="18"><div align="left" >{$userlist[postcode]|default="***"}</div></td>
            <td bgcolor="#FFFFFF" height="18"><div align="center" class="STYLE2 STYLE1"><a href="{:U('User/fansList',array('userid'=>$userlist[userid],'type'=>2))}">{$userlist[attention_num]}</a></div></td>
             <td bgcolor="#FFFFFF" height="18"><div align="center" class="STYLE2 STYLE1"><a href="{:U('User/fansList',array('userid'=>$userlist[userid],'type'=>1))}">{$userlist[fans_num]}</a></div></td>
            <td bgcolor="#FFFFFF" height="18" >{$userlist[addtime]}</td>
          </tr>
		</volist>
        </table>
        </form>
       </td>
        <td width="9" background="__PUBLIC__/images/tab_16.gif">&nbsp;</td>
      </tr>
    </table></td>
  </tr>
  <tr>
    <td height="29">
      <table width="100%" border="0" cellspacing="0" cellpadding="0">
       <tr>
         <td width="15" height="29"><img src="__PUBLIC__/images/tab_20.gif" width="15" height="29" /></td>
         <td background="__PUBLIC__/images/tab_21.gif">
            <table width="100%" border="0" cellspacing="0" cellpadding="0">
            <tr>
               <td width="25%" height="29" nowrap="nowrap"><span class="STYLE1">{$page}</span></td>
               <td width="75%" valign="top" class="STYLE1"  align="right">
                   全选<input type="checkbox" value="全选" id="allSelect" name="allSelect">
                  <input type="button"  id="Batch_addfans_but"  value="批量添加粉丝" style="padding-right:10px">
           </tr>
           </table>
         </td>
        <td width="14"><img src="__PUBLIC__/images/tab_22.gif" width="14" height="29" /></td>
      </tr>
    </table></td>
  </tr>
</table>
                        <div id="userinfo_div" style="display:none">
                           <form action="__URL__/addFans" method="post" name="add_fans_form"  onsubmit="return check_addfans_form()">
                           <input type="hidden"  name="userid_list" value="" id="userid_list">
                           <div style="display:block" id="addfans_userinfo">
                             用户 ID：<input type="text" name="add_userid" value="{$Think.request.userid}" onblur="show_userinfo(1,this)" id="add_userid"><br>
                             用户昵称：<input type="text" name="add_nickname" value="{$userinfo.nickname}" onblur="show_userinfo(2,this)" id="add_nickname"><br>
                            </div>
                             粉丝数量：<input name="add_fansnum"  type="text" value="0"  id="add_fansnum"><br>
                             <input type="submit"  value="添加粉丝">
                             <span id="tips_mess" style="color:red"></span>
                           </form>
                        </div>
 <script>
		(function(config) {
			config['extendDrag'] = false; // 注意，此配置参数只能在这里使用全局配置，在调用窗口的传参数使用无效
			config['lock'] = true;
			config['fixed'] = true;
			config['okVal'] = 'Ok';
			config['cancelVal'] = 'Cancel';
		})($.dialog.setting);

		$("#add_fans").click(function() {
			$.dialog({
				title : "添加粉丝",
				content : $("#userinfo_div").html()
			});
		})

		function show_userinfo(n, obj) {
			$.ajax({
				url : "__ACTION__",
				type : "post",
				data : "param=" + obj.value + "&type=" + n + "&ac=select_user",
				dataType : 'json',
				success : function(result) {
					//console.log(result);   
					
	            	if (result.status == 1) {
						$("#add_nickname").val(result.data.nickname);
						$("#add_userid").val(result.data.userid);
						$("#add_fansnum").focus();
						$("#tips_mess").html("");
					}
	            	else{
	            		$("#add_nickname").val('');
						$("#add_userid").val('');
						$("#add_fansnum").focus();
						$("#tips_mess").html("没有此用户");
	            	}
	            	   
				}
			})
		}

		function check_addfans_form() {
			if ($("#addfans_userinfo").css("display") != 'none') {
				if (!($("#add_userid").val()!='' && $("#add_fansnum").val()!='' && $(
						"add_nickname").val()!='')) {
					alert("表单不能为空");
					return false;
				}
			}
			var par = /^[0-9]*[1-9][0-9]*$/;
			if (!par.test($("#add_fansnum").val())) {
				alert("请输入有效的数字");
				$("#add_fansnum").focus();
				$("#add_fansnum").val("0");
				return false;
			}
			return true;
		}

		$("#Batch_addfans_but").click(function() {
			var list = seria();
			if (!list) {
				alert("请选择用户");
				return false;
			}
			$("#userid_list").val(list);
			$("#addfans_userinfo").css("display", "none");
			$.dialog({
				title : "批量添加粉丝",
				content : $("#userinfo_div").html()
			});

		})

		function seria() {
			var obj = $("input[id='listcheckbox']:not(:disabled)");
			var ids = '';
			obj.each(function() {
				if ($(this).attr('checked')) {
					ids += $(this).val() + ",";
				}
			});
			return ids;
		}
	</script>
<script>

	$("#allSelect").click(function() {
		var obj = $("input[id='listcheckbox']:not(:disabled)");
		if ($(this).is(':checked')) {
			obj.each(function() {
				$(this).attr('checked', true);
			});
		} else {
			obj.each(function() {
				$(this).attr('checked', false);
			});
		}
	});
	$("input[id='listcheckbox']:not(:disabled)").click(function() {
		var obj = $("input[id='listcheckbox']:not(:disabled):not(:checked)");
		if (obj.length) {
			$("#allSelect").attr('checked', false);
		} else {
			$("#allSelect").attr('checked', true);
		}
	});
</script>
   