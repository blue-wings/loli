<include file="Public:header" />
<style>
.input{border:0}
p{margin:0; padding:0;}
.blue{
	 background:#bcd4ec;  
}
</style>
<form action="__ACTION__" method="get" id="myform">
</form>
<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" id='tab'>
  <tr>
    <td height="30"><table width="100%" border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td width="15" height="30"><img src="__PUBLIC__/images/tab_03.gif" width="15" height="30" /></td>
        <td width="1101" background="__PUBLIC__/images/tab_05.gif"><img src="__PUBLIC__/images/311.gif" width="16" height="16" />盒子列表</td>
        <td width="281" background="__PUBLIC__/images/tab_05.gif"><table border="0" align="right" cellpadding="0" cellspacing="0">
            <tr>
              <td width="60"></td>
            </tr>
        </table></td>
        <td width="14"><img src="__PUBLIC__/images/tab_07.gif" width="14" height="30" /></td>
      </tr>
    </table></td>
  </tr>
  <tr>
    <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td width="9" background="__PUBLIC__/images/tab_12.gif">&nbsp;</td>
        <td bgcolor="#f3ffe3">
        <table width="99%" border="0" align="center" cellpadding="0" cellspacing="1" bgcolor="#c0de98" id="ChanngeColor">
          <tr background="__PUBLIC__/images/tab_14.gif" align="center" id="awarp">
          <td width="2%" height="18">置顶</td>
          <td width="2%" height="26">订单数</td>
            <td width="2%" height="26">盒子ID</td>
            <td width="8%" height="18">盒子名称</td>
            <td width="2%" height="18">会员价</td>
            <td width="2%" height="18">特权价</td>
            <td width="2%" height="18">定量</td>
            <td width="8%" height="18">售卖起止日期</td>
	    	<td width="3%" height="18">详情页</td>
	    	<td width="3%" height="18">选货单</td>
            <td width="4%" height="18">增值方案</td>
			<td width="4%" height="18">订单属性</td>
            <td width="5%" height="18">发货通知</td>
            <td width="4%" height="18">编辑操作</td>
          </tr>
          <volist name="list" id="boxlist" emtpy="这里一片空白" key='k'>
          <tr align="center">
            <td height="18" bgcolor="#FFFFFF">
				<a href="javascript:void(0)" class="top_{$k}" onclick="settop(this,'{$boxlist.boxid}')" ><eq name="boxlist.toptime" value="0">未置顶<else/><font color="red">置顶</font></eq></a>
				<input type="hidden" value="{$boxlist.toptime}">
			</td>
            <td height="18" bgcolor="#FFFFFF">
<!--               <a href="__APP__/BoxSend/orderList?boxid={$boxlist.boxid}&goodstype={$boxlist.category}&listname={$boxlist.boxname}&ifavalid=1&state=1&limit=1000"><b>查看订单</b></a> -->
			 <a href="{:U('BoxSend/orderList',array('boxid'=>$boxlist['boxid'],'goodstype'=>$boxlist['category'],'listname'=>$boxlist['boxname'],'ifavalid'=>1,'state'=>1,'limit'=>1000))}">
				<b><font color=red>{$boxlist.payper}</font></b>
			 </a>
            </td>
          	 <td height="18" bgcolor="#eeeeee">{$boxlist.boxid}</td>
          	  <td height="18" bgcolor="#FFFFFF">{$boxlist.boxname}</td>
            <td height="18" bgcolor="#FFFFFF">{$boxlist.price}</td>
            <td height="18" bgcolor="#FFFFFF">{$boxlist.member_price}</td>
            <td height="18" bgcolor="#FFFFFF">{$boxlist.quantity}</td>
            <td height="18" bgcolor="#FFFFFF">开始：<font color=blue>{$boxlist.starttime}</font><br/>截止：<font color=red>{$boxlist.endtime}</font></td>
	    <td height="18" bgcolor="#FFFFFF">
	    		  <if condition="$boxlist.bid eq ''">
	    		  	<a href="#" onclick="dialogmeseeage('{:U('Box/detail',array('id'=>$boxlist[boxid],'name'=>$boxlist[boxname]))}','创建盒子详情')">未配置</a>
	    		  <elseif condition="$boxlist.payper gt 0" />
	    		  	<a href="#" onclick="dialogmeseeage('{:U('Box/detail',array('id'=>$boxlist[boxid],'name'=>$boxlist[boxname],'key'=>$k))}','修改盒子详情')"><font color=red>修改</font></a>
				  <else/>	
				  	<a href="#" onclick="dialogmeseeage('{:U('Box/detail',array('id'=>$boxlist[boxid],'name'=>$boxlist[boxname],'key'=>$k))}','修改盒子')"><font color=red>修改</font></a>
	    		  	/<a href="#" onclick="return deldetail('{$boxlist[boxid]}')"><font color="#CCCCCC">删除</font></a>
	    		  </if>
	    </td>
	    <td height="18" bgcolor="#FFFFFF">
			<if condition="$boxlist.ptotal eq ''">	    
	    	 <a href="#" onclick="dialogmeseeage('{:U('Box/boxChooseOrder',array('boxid'=>$boxlist['boxid'],'boxname'=>$boxlist['boxname']))}','选货单')">未配置</a>
		    <elseif condition="$boxlist.payper gt 0" />
				 <a href="#" onclick="dialogmeseeage('{:U('Box/boxChooseOrder',array('boxid'=>$boxlist['boxid'],'boxname'=>$boxlist['boxname']))}','选货单')">修改</a>
			<else/>
			  <a href="#" onclick="dialogmeseeage('{:U('Box/boxChooseOrder',array('boxid'=>$boxlist['boxid'],'boxname'=>$boxlist['boxname']))}','选货单')">修改</a>/
			  <a href="{:U('Box/delboxProducts',array('boxid'=>$boxlist['boxid']))}"><font color="#CCCCCC">删除</font></a>
			</if>
	    </td>

		<td height="18" bgcolor="#FFFFFF">
			<a href="#" onclick="dialogmeseeage('__URL__/selectBoxRelation/boxid/{$boxlist.boxid}','选择增值方案')">配置方案</a>
		</td>		

			<td height="18" bgcolor="#CCCC33">
			<span id="boxset_{$boxlist.boxid}">
				<if condition="$boxlist.if_setbox eq 1">
				<eq name="boxlist.if_order" value="1">
					<a href="javascript:void(0)" onclick="return alert('此盒子已有订单，不能删除');">删除</a>&nbsp;/&nbsp;<a href="javascript:void(0)" onclick="return alert('此盒子已有订单，不能修改');">修改</a>
				<else />
					<a href="javascript:void(0)" onclick="delBoxset('{$boxlist.boxid}')">删除</a>&nbsp;/&nbsp;<a href="#" onclick="dialogmeseeage('__URL__/add_boxset/boxid/{$boxlist.boxid}','修改盒子订单属性')">修改</a>
				</eq>
				<else />
					 <a href="#" onclick="dialogmeseeage('__URL__/add_boxset/boxid/{$boxlist.boxid}','配置盒子订单属性')">未配置</a>
				</if>
				</span>
			</td>

             <td height="18" bgcolor="#FFFFFF"><div align="center"><span class="STYLE1"><a onclick="return confirm('确认加入短信发送列表吗?')" href="__URL__/addTasklist?boxid={$boxlist.boxid}&type=2&goodstype={$boxlist.category}&listname={$boxlist.boxname}">加入列表</a></span></div></td>
             
            <td height="18" bgcolor="#eeeeee">
            <if condition="$boxlist.payper elt 0" >
				<span class="STYLE1"></span>
				<a onclick="return confirm('确认将此信息删除吗?')" href="__URL__/delBox/boxid/{$boxlist.boxid}">删除</a> 
			</if>
			<a href="__URL__/editBox/boxid/{$boxlist.boxid}">编辑</a>
			</td>
          </tr>
		</volist>
        </table></td>
        <td width="9" background="__PUBLIC__/images/tab_16.gif">&nbsp;</td>
      </tr>
    </table></td>
  </tr>
  <tr>
    <td height="29"><table width="100%" border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td width="15" height="29"><img src="__PUBLIC__/images/tab_20.gif" width="15" height="29" /></td>
        <td background="__PUBLIC__/images/tab_21.gif"><table width="100%" border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td width="25%" height="29"></td>
            <td width="75%" class="STYLE1">{$page}</td>
          </tr>
        </table></td>
        <td width="14"><img src="__PUBLIC__/images/tab_22.gif" width="14" height="29" /></td>
      </tr>
    </table></td>
  </tr>
</table>
<script>
$(function(){
		$("#ChanngeColor tr:gt(0)").hover(function() {
			$(this).children("td").addClass("blue");
		}, function() {
			$(this).children("td").removeClass("blue");
		});
})

function deldetail(boxid){
	if(boxid != null){
		$.dialog({
			title:'删除盒子详细信息',
			content:'您确定删除么?',
			ok:function(){
				$.ajax({
					url:"{:U('Box/deltail')}",
					type:"post",
					dataType:"json",
					data:"boxid="+boxid+'&n='+Math.random(),
					success: function(chkresult){
						if(parseInt(chkresult.status)==1){
							alert('删除成功!');
							location.reload();
						}else{
							alert('删除失败!');
						}
					}
				})
			},
			cancel: true
		});
	}
}

 function	settop(obj,boxid){
		var hiddenval = $(obj).next("input:hidden");
		var stats = (hiddenval.val() == 0)?1:0;		
				
		$.post("__ACTION__",{boxid:boxid,stats:stats},function(reponse){
			
			if(reponse != '' && reponse.status ==1){
					if(reponse.info == 1){
						$(obj).html("<font color='red'>置顶</font>");
						hiddenval.val(1);
					}else{
						$(obj).html("未置顶");
						hiddenval.val(0);
					}
			}					
		})			
	}
	
pregpattern({
	"toptime":"置顶"
});	


function delBoxset(boxid){
	if(!boxid){
		return false;
	}
	if(confirm("确定要删除该盒子的属性吗？")){
		$.ajax({
			url:"{:u('Box/del_box_order_set')}",
			type:"post",
			dataType:"json",
			data:{boxid:boxid},
			success:function(ret){
				if(parseInt(ret.status)==1){
					var msg="<a href=\"#\" onclick=\"dialogmeseeage('__URL__/add_boxset/boxid/"+boxid+"','创建盒子属性')\">创建</a>";
					$("#boxset_"+boxid).html(msg);
					alert("删除成功！");
				}else{
					alert(ret.info);
				}
			}
		})	
	}
}

</script>	
<include file="Public:footer" />