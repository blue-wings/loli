<include file="Public:header" />
<link rel="stylesheet" href="/public/js/jquery_theme/base/jquery.ui.all.css">
<script src="/public/js/jquery_ui/jquery.ui.core.js"></script>
<script src="/public/js/jquery_ui/jquery.ui.widget.js"></script>
<script src="/public/js/jquery_ui/jquery.ui.datepicker.js"></script>
<link rel="stylesheet" href="__PUBLIC__/js/colorbox/colorbox.css">
<script src="__PUBLIC__/js/colorbox/jquery.colorbox-min.js"></script>
<style>
#showl{
	list-style-type : none;
}

#showl > li{ 
	float:left;
	line-height:30px;
	width:250px;
}
</style>
<div class="panel">
		<div align="left">			
			<fieldset class="fieldset">
			<legend>查询条件</legend>
			    <form id="myform" action="__ACTION__" method="GET">
			         统计时间：从<input type="text" id="starttime" name="starttime"
					value="{$Think.get.starttime}">到<input type="text"
					id="endtime" name="endtime" value="{$Think.get.endtime}">
			         <input type="submit" name="search" value="查询">
		        </form>
		   </fieldset>			
		</div>
</div>

<table width="100%" border="0" align="center" cellpadding="0"
	cellspacing="0">
  <tr>
    <td height="30"><table width="100%" border="0" cellspacing="0"
				cellpadding="0">
      <tr>
        <td width="15" height="30"><img
						src="__PUBLIC__/images/tab_03.gif" width="15" height="30" /></td>
        <td width="1101" background="__PUBLIC__/images/tab_05.gif"><img
						src="__PUBLIC__/images/311.gif" width="16" height="16" /> <span
						class="STYLE4">分享数据统计列表</span></td>
        <td width="281" background="__PUBLIC__/images/tab_05.gif"><table
							border="0" align="right" cellpadding="0" cellspacing="0">
            <tr>
            </tr>
        </table></td>
        <td width="14"><img src="__PUBLIC__/images/tab_07.gif"
						width="14" height="30" /></td>
      </tr>
    </table></td>
  </tr>
   <tr>
    <td><table width="100%" border="0" cellspacing="0"	cellpadding="0">
      <tr>
        <td width="9" background="__PUBLIC__/images/tab_12.gif">&nbsp;</td>
        <td bgcolor="#f3ffe3"><table width="99%" border="0"
							align="center" cellpadding="0" cellspacing="1" bgcolor="#c0de98">
          <tr background="__PUBLIC__/images/tab_14.gif" align="center" id="awarp">
              <td width="15%" height="18">统计日期</td>
               <td width="10%" height="18">内部用户发布分享数</td>
              <td width="10%" height="18">真实用户发布分享数</td>
              <td width="10%" height="18">真实参与发布分享人数</td>
              <td width="10%" height="18">分享评论数</td>
              <td width="10%" height="18">评论分享用户数</td>
              <td width="10%" height="18">当日用户发布分享总数</td>
              <td width="10%" height="18">当日参与分享用户总数</td>
          </tr>	
		<volist name="list" id="vo" empty="还没有统计数据">
          <tr align="center" bgcolor="FFFFFF">
              <td width="15%" height="18">
				  <a href="{:U('UserShare/index',array('from'=>$vo['stat_date'],'to'=>$vo['stat_date']))}">
					 {$vo.stat_date}
				  </a>
			  </td>
              <td width="10%" height="18">
				<a href="{:U('UserShare/index',array('from'=>$vo['stat_date'],'to'=>$vo['stat_date'],'usertype'=>'interior'))}">{$vo.inner_post_num}</a></td>
              <td width="10%" height="18">
				<a href="{:U('UserShare/index',array('from'=>$vo['stat_date'],'to'=>$vo['stat_date'],'usertype'=>'real'))}">{$vo.real_post_num} </a>	
			  </td>
              <td width="10%" height="18">
				<a href="javascript:void(0)"  onclick="adddata('{$vo['stat_date']}','real_total')">{$vo.real_user_num}</a>
			  </td>
			  <td width="10%" height="18"><a href="javascript:void(0)" onclick="adddata('{$vo['stat_date']}','reply_list')">{$vo.reply_num}</a></td>
              <td width="10%" height="18"><a  href="javascript:void(0)"  onclick="adddata('{$vo['stat_date']}','reply')" >{$vo.reply_user_num}</a></td>
              <td width="10%" height="18">
			  <a href="{:U('UserShare/index',array('from'=>$vo['stat_date'],'to'=>$vo['stat_date']))}">
			  {$vo.post_total}</a>
			  </td>
              <td width="10%" height="18">
				<a href="javascript:void(0)" onclick="adddata('{$vo['stat_date']}','user_total')">{$vo.user_total}</a>
			  </td>
          </tr>
		</volist>
        </table></td>
        <td width="9" background="__PUBLIC__/images/tab_16.gif">&nbsp;</td>
      </tr>
    </table></td>
  </tr>
  <tr>
    <td height="29"><table width="100%" border="0" cellspacing="0"
				cellpadding="0">
      <tr>
        <td width="15" height="29"><img
						src="__PUBLIC__/images/tab_20.gif" width="15" height="29" /></td>
        <td background="__PUBLIC__/images/tab_21.gif"><table
							width="100%" border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td width="25%" height="29" nowrap="nowrap"><span
									class="STYLE1">{$page}</span></td>
            <td width="75%" valign="top" class="STYLE1"></td>
          </tr>
        </table></td>
        <td width="14"><img src="__PUBLIC__/images/tab_22.gif"
						width="14" height="29" /></td>
      </tr>
    </table></td>
  </tr>
</table><br>
<table width="100%" border="0" align="center" cellpadding="0"
	cellspacing="0">
  <tr>
    <td height="30"><table width="100%" border="0" cellspacing="0"
				cellpadding="0">
      <tr>
        <td width="15" height="30"><img
						src="__PUBLIC__/images/tab_03.gif" width="15" height="30" /></td>
        <td width="1101" background="__PUBLIC__/images/tab_05.gif">
			<img src="__PUBLIC__/images/311.gif" width="16" height="16" /> 
			<span>评测总计<a href="#showlist" class="record"></a><a href="#relp" class="record1"></a></span>
		</td>
        <td width="281" background="__PUBLIC__/images/tab_05.gif"></td>
        <td width="14"><img src="__PUBLIC__/images/tab_07.gif" 	width="14" height="30" /></td>
      </tr>
    </table></td>
  </tr>
<table width="99%" border="0"  align="center" cellpadding="0" cellspacing="1" bgcolor="#c0de98">
          <tr background="__PUBLIC__/images/tab_14.gif"  align="center">
              <td width="15%" height="30">统计日期</td>
              <td width="10%" height="30">内部用户发布分享数</td>
              <td width="10%" height="30">真实用户发布分享数</td>
              <td width="10%" height="30">真实参与发布分享人数</td>
              <td width="10%" height="30">分享评论数</td>
              <td width="10%" height="30">评论分享用户数</td>
              <td width="10%" height="30">当日用户发布分享总数</td>
              <td width="10%" height="30">当日参与分享用户总数</td>
          </tr>	
          <if condition="$total">
          <tr align="center" bgcolor="FFFFFF">
			  <td width="15%" height="30">{$total.tip|default="所有记录"}</td>
              <td width="10%" height="30"><a href="{:U('UserShare/index',array('from'=>$total['mintime'],'to'=>$total['maxtime'],'usertype'=>'interior'))}">{$total.tipn}</a></td>
              <td width="10%" height="30"><a href="{:U('UserShare/index',array('from'=>$total['mintime'],'to'=>$total['maxtime'],'usertype'=>'real'))}">{$total.trpn}</a></td>
              <td width="10%" height="30"><a href="{:U('UserShare/index',array('from'=>$total['mintime'],'to'=>$total['maxtime'],'usertype'=>'real'))}">{$total.trun}</a></td>
              <td width="10%" height="30"><a href="{:U('UserShare/index',array('from'=>$total['mintime'],'to'=>$total['maxtime']))}">{$total.trn}</a></td>
              <td width="10%" height="30"><a href="{:U('UserShare/index',array('from'=>$total['mintime'],'to'=>$total['maxtime']))}">{$total.trunn}</a></td>
              <td width="10%" height="30"><a href="{:U('UserShare/index',array('from'=>$total['mintime'],'to'=>$total['maxtime']))}">{$total.tpt}</a></td>
              <td width="10%" height="30">{$total.tut}</td>
          </tr>
          </if>
</table>
</tr>
</table>

<div style="display:none">
	<div id="showlist">
		查找:<input name='search' value="">
		<ul id="showl"></ul>
	</div>
	<div id="relp"></div>
</div>


 <script>
	jQuery(function($){
		$.datepicker.regional['zh-CN'] = {
			closeText: '关闭',
			prevText: '&#x3c;上月',
			nextText: '下月&#x3e;',
			currentText: '今天',
			monthNames: ['一月','二月','三月','四月','五月','六月',
			'七月','八月','九月','十月','十一月','十二月'],
			monthNamesShort: ['一','二','三','四','五','六',
			'七','八','九','十','十一','十二'],
			dayNames: ['星期日','星期一','星期二','星期三','星期四','星期五','星期六'],
			dayNamesShort: ['周日','周一','周二','周三','周四','周五','周六'],
			dayNamesMin: ['日','一','二','三','四','五','六'],
			weekHeader: '周',
			dateFormat: 'yy-mm-dd',
			firstDay: 1,
			isRTL: false,
			showMonthAfterYear: true,
			yearSuffix: '年'};
		$.datepicker.setDefaults($.datepicker.regional['zh-CN']);
	});
	$(function() {
		$( "#starttime" ).datepicker({
			defaultDate: "-1w",
			changeMonth: true,
			numberOfMonths: 1,
			onSelect: function( selectedDate ) {
				$( "#endtime" ).datepicker( "option", "minDate", selectedDate );
			}
		});
		$( "#endtime" ).datepicker({
			defaultDate: "+1w",
			changeMonth: true,
			numberOfMonths: 1,
			onSelect: function( selectedDate ) {
				$( "#starttime" ).datepicker( "option", "maxDate", selectedDate );
			}
		});
	});
	

	
$(function(){
	$(":text[name='search']").keyup(function(){
		var str = $(this).val();
		$("#showl li a").each(function(i,dom){
			if($(dom).text().indexOf(str) == -1){
				$(this).parent().hide();	
			}else{
				$(this).parent().show();
			}
		})
	})
})

function gourl(dtime,userid){
	var ss ="{:U('UserShare/index')}";
	ss+='/from/'+dtime+'/to/'+dtime+'/userid/'+userid;
	location.href=ss;
}	

$(".record").colorbox({inline:true,height:"80%",width:"80%"});
$(".record1").colorbox({inline:true,height:"90%",width:"95%"});

pregpattern({
	"stat_date":"统计日期",
	"inner_post_num":"内部用户发布分享数",
	"real_post_num":"真实用户发布分享数",
	"reply_num":"分享评论数",
	"real_user_num":"真实参与发布分享人数",
	"reply_user_num":"评论分享用户数",
	"post_total":"当日用户发布分享总数",
	"user_total":"当日参与分享用户总数"
});

function adddata(time,flag){
	if(flag != 'reply_list'){
		 $.ajax({
			url:"__ACTION__",
			type:"post",
			dataType:"json",
			async:false,
			data:"time="+time+"&query="+flag,
			success:function(reponse){
				$("#showl").empty();
				for(var i in reponse){
					var str = null;
					str ="<li><a title='点击查询' href='javascript:void(0)' onclick='gourl(\""+time+"\",\""+reponse[i].userid+"\")' >("+reponse[i].userid+")"+reponse[i].nickname+"</a></li>"; 
					$("#showl").append(str);
				}	
				$("a.record").click();
			}
		})
	}else{
		$.post("__ACTION__",{time:time,query:flag},function(rep){			
			$("#relp").html(rep);
			$("a.record1").click();
		})
	}	
}
 </script>
<include file="Public:footer" />