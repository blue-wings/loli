<include file="Public:header" />
<link rel="stylesheet" href="/public/js/jquery_theme/base/jquery.ui.all.css">
<script src="/public/js/jquery_ui/jquery.ui.core.js"></script>
<script src="/public/js/jquery_ui/jquery.ui.widget.js"></script>
<script src="/public/js/jquery_ui/jquery.ui.datepicker.js"></script>
<link rel="stylesheet" href="/public/colorbox/colorbox.css">
<script src="/public/colorbox/jquery.colorbox-min.js"></script>
<style>
tr{
	text-align:center;
}
.f_width{
	display:block;
	width:120px;
	float:left;
	height:20px;
	font-size:14px;
	font-weight:bold;
}
input{
	border-color:#008080;
}
.createmakt,.particular{
	display:none;
}
.show{
	display:none;
}
.ntitle{
	font-size:16px;
	color:#004040;
}
.left{
	padding:10px  50px;
}
.fo{
	font-size:14px;
	color:#004040;
}
</style>
<script>
$(function(){
	$(".inline").colorbox({inline:true, width:"70%"});
})
</script>
<div class="panel">
	<div align="left">
		<fieldset class="fieldset"><legend>查询条件</legend>
			<form name="myform" id="myform" action="__ACTION__" method="POST">
				状态：<select name="status"  id="status">
				 <option value="">全部</option>
				 <option value="0">关闭</option>
				 <option value="1">打开</option>
				 </select>
				 类型：<select name="type"  id="type">
				 <option value="">全部</option>
				 <option value="1">邮件</option>
				 <option value="2">手机</option>
				 </select>
				<input type='submit' name='search' value=" 查 询">
			    
			    <if condition='$_SESSION[account] eq "admin"'>
			         <input type='button' id='upload_edm_file' value="上传推广文件">
			    </if>
			    <script>
		    	    var api ;
		    	    $("#upload_edm_file").click(function(){
		    	    	 api=$.dialog({
	    	            	 id: 'LHG1976D',
					    	title:"上传推广邮箱文件",
					    	content:'<iframe id="hidden_frame"  style="display:none"></iframe><form action="__ACTION__/ac/createedmfile" method="POST" enctype="multipart/form-data"  target="hidden_frame"> 文件必须是<span style="color:red">txt格式,UTF-8编码<br><br></span><input type="file"  name="edm_file_txt"><br><input type="submit"  name="提交"></form></div>',
			      	 });
		    	    })
		    	   
		    	    function callback(f){
		    	    	if(f>0){
		    	    		alert("上传成功");
		    	    	}else if(f==0){
		    	    		alert("上传失败");
		    	    	}else if(f == -1){
		    	    		alert("文件后缀错误");
		    	    	}else if(f==-3){
		    	    		alert("请选择文件");
		    	    	}
		    	    	setTimeout("api.close();",1000);
		    	    }
			    </script>
			</form>
		</fieldset>			
	</div>
</div>
<div class="showcontents">
<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0">
  <tr>
    <td height="30"><table width="100%" border="0" cellspacing="0" cellpadding="0">
      <tr style="text-align:left">
        <td width="15" height="30"><img src="__PUBLIC__/images/tab_03.gif" width="15" height="30" /></td>
        <td width="281" background="__PUBLIC__/images/tab_05.gif"><img src="__PUBLIC__/images/311.gif" width="16" height="16" />推广日志列表</td>
        <td width="1101" background="__PUBLIC__/images/tab_05.gif" align="right">
        {$page}
        </td>
        <td width="14"><img src="__PUBLIC__/images/tab_07.gif" width="14" height="30" /></td>
      </tr>
    </table></td>
  </tr>
  <tr>
    <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td width="9" background="__PUBLIC__/images/tab_12.gif">&nbsp;</td>
        <td bgcolor="#f3ffe3">
         <table width="99%" border="0" align="center" cellpadding="0" cellspacing="1" bgcolor="#c0de98">
          <tr background="__PUBLIC__/images/tab_14.gif">
            	<td width="5%" height="26">ID</td>
	    	 <td width="5%" height="26"><div align="center" class="STYLE2 STYLE1">类型</div></td>
             <td width="10%" height="18"><div align="center" class="STYLE2 STYLE1">发送标题</div></td>
             <td width="3%" height="18"><div align="center" class="STYLE2">内容</div></td>  
             <td width="3%" height="18"><div align="center" class="STYLE2">状态</div></td>
            <td width="10%" height="18"><div align="center" class="STYLE2">过滤条件</div></td>
            <td width="15%" height="18"><div align="center" class="STYLE2">条件描述</div></td>
            <td width="8%" height="18"><div align="center" class="STYLE2">发送数量</div></td>          
            <td width="15%" height="18"><div align="center" class="STYLE2">创建时间</div></td>
            <td width="8%" height="18"><div align="center" class="STYLE2">操作</div></td>
          </tr>
          <volist name="list" id="vo"  key="k">
          <tr height="30px">
          	<td bgcolor="#FFFFFF" height="18"><a href="javascript:void()" onclick="show_log('{$vo.id}')">{$vo.id}</a></td>
             <td bgcolor="#FFFFFF" height="18">
                <eq name="vo.type"  value="1">邮件<else/>手机</eq>
			 </td>
             <td bgcolor="#FFFFFF" height="18">
				{$vo.title}
			 </td>
			 <td bgcolor="#FFFFFF"  height="18"  class="STYLE2 br">
			 	<div style="display:none;" >
					<div style='padding:10px; background:#fff;' id="content_{$vo.id}">
				    	{$vo.content}
					</div>
				</div>
		       		<a class='inline' href="#content_{$vo.id}"><font color='red'>查看</font></a>
			 </td>
			 <td bgcolor="#FFFFFF" height="18"  onclick="change_status('{$vo.id}',this)"><img src="__PUBLIC__/images/status_{$vo.status}.gif" /></td>
			 <td bgcolor="#FFFFFF" height="18">
				{$vo.filtersql}
			 </td>
			  <td bgcolor="#FFFFFF" height="18">
				{$vo.remark}
			 </td>
			 <td bgcolor="#FFFFFF" height="18">{$vo.totalnum}</td>
			 <td bgcolor="#FFFFFF" height="18">
				{$vo.addtime|date="Y-m-d H:i:s",###}
			 </td>
			 
			   <td bgcolor="#FFFFFF" height="18">
				<if condition="$vo[totalnum] elt 0">  <a onclick="if(confirm('你确定删除'))del_task('{$vo.id}')">删除</a><br></if>
				  <a  onclick="edit_task('{$vo.id}')">编辑</a>
			 </td>
          </tr>
		</volist>
        </table>
		</td>
        <td width="9" background="__PUBLIC__/images/tab_16.gif">&nbsp;</td>
      </tr>
    </table></td>
  </tr>
  <tr>
	<if condition="$list eq ''  OR $list eq null">
	<td  colspan='9'><b>无数据</b></td>
	<else />
	<td  colspan='9'>{$page}</td>
	</if>
  </tr>
</table>
</div>
<script>
     $("#status").val('{$Think.request.status}');
     $("#type").val('{$Think.request.type}');
    
     function show_log(id){
    	 $.dialog({
    		 title:"发送日志查看",
    		 content:"url:__URL__/promotionLogList/taskid/"+id,
    		 width:"900px",
    	 })
     }
     
     function change_status(id,obj)
     {
    	 $.ajax({
    		 type:"post",
    		 dataType:"json",
    		 data:"id="+id,
    		 url:"__URL__/changeTaskStatus",
    		 success:function(json){
    			 if(json.status==1){
    				 obj.innerHTML='<img src="__PUBLIC__/images/status_'+json.data+'.gif">';
    			 }else{
    				 alert(json.info);
    			 }
    		 }
    	 })
     }
     
     function del_task(id)
     {
    	 $.ajax({
    		 type:"post",
    		 dataType:"json",
    		 data:"ac=del&id="+id,
    		 url:"__URL__/promotionTaskOperating",
    		 success:function(json){
    			 if(json.status==1){
    				 alert("删除成功");
    				 location.reload() ;
    			 }else{
    				 alert(json.info);
    			 }
    		 }
    	 })
     }
     
     function edit_task(id)
     {
    	 $.dialog({
    		 title:"编辑推广任务",
    		 content:"url:__URL__/promotionTaskOperating/ac/edit/id/"+id,
    		 width:"600px",
    	 })
     }
</script>
<include file="Public:footer" />