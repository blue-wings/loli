<include file="Public:header" />
<script type="text/javascript" src="__PUBLIC__/js/jquery.DOMWindow.js"></script>
<script language="javascript" type="text/javascript" src="__PUBLIC__/My97DatePicker/WdatePicker.js"></script>
<script type="text/javascript">
$(function(){
	var details="{$Think.get.details}";
	if(details!=null){
		$("select[name='details']").val(details);
	}	

	$("#couponbtn").click(function(){
		var price = $("#price").val();
		if(isNaN(price) ||  price <= 0){
			alert("价格必须为数字并且大于0并且必须为正整数。");
			return false;
		}
		var num = $("#getcode").val();
		var starttime = $("#starttime").val();
		var endtime = $("#endtime").val();
		if(num <=10){
			$("#optCodeDiv").html("");
			$("#num").val(num);
			$("#price1").val(price);
			$("#starttime1").val(starttime);
			$("#endtime1").val(endtime);
			$.post('__URL__/createCoupon/num/'+num+'/isajax/1',function(data){
				var str="<table>";
				$.each(data,function(j,n){
					str+="<tr><td>"+n+"<input name='code"+j+"' type='hidden' value='"+n+"' /></td>";
				    str+="<td><input name='owner_uid"+j+"' type='text'  size=5 /></td><td><input name='remark"+j+"' type='text' /></td>";			
				});
				str+="</table>";
				$("#optCodeDiv").html(str);
			},'json');
			var needwidth = ($(document).width()-100-380)/2;
			var needheight = ($(document).height()-500)/2;
			$(this).openDOMWindow({ 
				height:250, 
				width:350, 
				positionType:'absolute', 
				positionTop:needheight, 
				eventType:null, 
				positionLeft:needwidth, 
				windowSourceID:'#createCodediv',
				windowPadding:10, 
				draggable:1, 
				windowBGColor:'#FFFFFF', 
				borderColor:'#999999', 
				overlayOpacity:70
//				overlay:0
			}); 	
		}else{
		 	location.href="__URL__/addCouponAndDown/num/"+num+"/price/"+price+"/starttime/"+starttime+"/endtime/"+endtime+"/isajax/0";
		}
	});
	$("#closediv").closeDOMWindow({eventType:'click'});
});
</script>
<div class="panel">
	<div align="left" style="color:#0080FF;font-size:16px">
	<fieldset class="fieldset">
		<legend>优惠劵</legend>
		优惠劵数量：
		<select name="getcode" id="getcode">
		<for start="1" end="11">
		<option value="{$i}">{$i}</option>
		</for>
		<option value="15">15</option>
		<option value="20">20</option>
		<option value="50">50</option>
		<option value="100">100</option>
		<option value="200">200</option>
		<option value="500">500</option>
		</select>
		优惠劵金额：<input id="price" name="price" type='text'  size="10"/>
		有效期：<input id="starttime" name="starttime" type='text' value="<php>echo date('Y-m-d')</php>" onClick="WdatePicker()" />到<input id="endtime" name="endtime" type='text' value="<php>echo date('Y-m-d',time()+86400)</php>" onClick="WdatePicker()"/>
		<input type="button" value="确定" id="couponbtn" />
		<span style="color:red;">&nbsp;&nbsp;P.S.:当<=10个的时候,弹出框显示,>10个的直接下载。</span>
		<legend>已有优惠劵查询</legend>
		<form name="selCodeForm" action="__ACTION__" method="get">
		优惠劵查询：<input id="code" name="code" type='text' value="{$Think.get.code}" />
		
		<select name="details">
			<option value=''>全部</option>
			<option value='1'>系统产生</option>
			<option value='2'>用户兑换</option>
		</select>
		<br/><br/>
		<input type="button" name="resetpage" value="重置">
		<input type="submit" name="search"/>
		</form>
	</fieldset>
	</div>
</div>
<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0">
  <tr>
    <td height="30"><table width="100%" border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td width="15" height="30"><img src="__PUBLIC__/images/tab_03.gif" width="15" height="30" /></td>
        <td width="1101" background="__PUBLIC__/images/tab_05.gif"><img src="__PUBLIC__/images/311.gif" width="16" height="16" /> <span class="STYLE4">优惠劵管理</span></td>
        <td width="281" background="__PUBLIC__/images/tab_05.gif"><table border="0" align="right" cellpadding="0" cellspacing="0">
            <tr>
            </tr>
        </table></td>
        <td width="14"><img src="__PUBLIC__/images/tab_07.gif" width="14" height="30" /></td>
      </tr>
    </table></td>
  </tr>
  <tr>
    <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td width="9" background="__PUBLIC__/images/tab_12.gif">&nbsp;</td>
        <td bgcolor="#f3ffe3"><table width="99%" border="0" align="center" cellpadding="0" cellspacing="1" bgcolor="#c0de98">
          <tr background="__PUBLIC__/images/tab_14.gif" align="center">
            <td width="8%" height="18">ID</td>
            <td width="10%" height="18">优惠劵编码</td>
            <td width="12%" height="18">开始日期</td>
            <td width="12%" height="18">截止日期</td>
            <td width="10%" height="18">使用状态</td>
            <td width="10%" height="18">价格</td>
            <td width="12%" height="18">添加日期</td>
             <td width="15%" height="18">发放人</td>
            <td width="12%" height="18">备注</td>
          </tr>
          <volist name="list" id="vo" emtpy="还啥玩意没有呢！">
          <tr align="center"  bgcolor="FFFFFF">
            <td height="18">{$vo.id}</td>
            <td height="18">{$vo.code}</td>
            <td height="18">{$vo.starttime}</td>
            <td height="18">{$vo.endtime}</td>
            <td height="18">
            <switch name="vo.status">
			<case value="1">未使用</case>
			<case value="2">已使用</case>
			<default />无
			</switch>
            </td>
            <td height="18">{$vo.price}</td>
            <td height="18">{$vo.addtime}</td>
            <td height="18"><volist name="vo.user" id="provo" key="k">{$provo.nickname}({$provo.account})</volist>
            </td>
            <td height="18">
            <notempty name="vo.owner_nickname">
           	<b>TO：<a href="/space/{$vo[owner_uid]}" target="_blank">{$vo[owner_nickname]}</a></b>
			</notempty>
            <empty name="vo.remark">暂无<else /><br/>{$vo.remark}</empty></td>
            <td height="18"></td>
          </tr>
		</volist>

        </table></td>
        <td width="9" background="__PUBLIC__/images/tab_16.gif">&nbsp;</td>
      </tr>
    </table></td>
  </tr>
  <tr>
    <td height="29"><table width="100%" border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td width="15" height="29"><img src="__PUBLIC__/images/tab_20.gif" width="15" height="29" /></td>
        <td background="__PUBLIC__/images/tab_21.gif"><table width="100%" border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td width="25%" height="29" nowrap="nowrap"><span class="STYLE1">{$page}</span></td>
            <td width="75%" valign="top" class="STYLE1"></td>
          </tr>
        </table></td>
        <td width="14"><img src="__PUBLIC__/images/tab_22.gif" width="14" height="29" /></td>
      </tr>
    </table></td>
  </tr>
</table>


<table width="300" border="0" cellspacing="0" cellpadding="0"  id="createCodediv" style="text-align:center;display:none; margin:20px;">
  <tr>
    <th colspan="3" bgcolor="#c0de98" scope="col">生成优惠劵<a href="javascript:void(0);" id="closediv" style="margin-left:80px;">【关闭】</a></th>
  </tr>
  <tr>
    <td width="30%">优惠劵</td>
    <td width="30%">用户ID</td>
    <td width="40%">备注</td>
  </tr>
  <tr><td colspan="3">
  <form action="__URL__/addCoupon" method="POST" name="codeForm">
  <div id="optCodeDiv"></div>
  <div>
  <input type="hidden" name="num" id="num" />
  <input type="hidden" name="price1" id="price1" />
  <input type="hidden" name="starttime1" id="starttime1" />
  <input type="hidden" name="endtime1" id="endtime1" />
  <input type="submit" value="确定" /></div>
  </form>
  </td>
  </tr>
</table>
<include file="Public:footer" />