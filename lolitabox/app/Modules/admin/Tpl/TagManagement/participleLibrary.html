<include file="Public:header" />
<style>
input,select{
	border:solid #808080 1px;
}

.tawid{
	height:25px;
	border-collapse:collapse;
	width:90%;
}

.tawid tr{height:28px;}
.tawid td{ border:1px solid #666; border-collapse:collapse; text-align:center;}
.tb1{width:800px}
.valnull{font-weight:bolder;color:#FF8040;};
.datalist{border:0;}
</style>
<script>
(function(config){
	config['extendDrag'] = false; // 注意，此配置参数只能在这里使用全局配置，在调用窗口的传参数使用无效
	config['lock'] = true;
	config['fixed'] = true;
	config['okVal'] = 'Ok';
	config['cancelVal'] = 'Cancel';
})($.dialog.setting);

$(function(){
	var tstatus = "{$Think.get.tstatus}";
	if(tstatus){
		$("select[name='tstatus']").val(tstatus);
	}

	var tagtype = "{$Think.get.tagtype}";
	if(tagtype){
		$("select[name='tagtype']").val(tagtype);
	}
})
</script>
	<div align="left">
		<fieldset class="fieldset"><legend>工单列表</legend>
			<form action="__ACTION__" id="myform" method="GET">
				分词名称:<input type="text" name="tagname" value="{$Think.get.tagname}">&nbsp;&nbsp;&nbsp;
				标签是否有效:<select name="tstatus">
						<option value="">全部</option>
						<option value="1">有效</option>
						<option value="0">无效</option>
				</select>&nbsp;&nbsp;&nbsp;
				标签类型:
				<select name="tagtype">
					<option value="">全部</option>
					<option value="11">产品品牌</option>
					<option value="12">产品分类</option>
					<option value="13">产品名称</option>
					<option value="14">产品功效</option>
				</select>
				{/*
				排序：<select name="order">
				     <option value="">默认</option>
				     <option value="totalnum desc"  <eq name="Think.request.order" value="totalnum desc">selected</eq> >数量倒序</option>
				</select>
				*/}
				<br/><br/>
				<input type="button" name="resetpage" value="重置"> 
				<input type="submit" value="查询"  name="sub" style="width:100px;">&nbsp;&nbsp; <br/><br/>
				<input type="button" onclick="manage('','','','','')" value="创建标签">
			</form>
		</fieldset>			
	</div>

<table cellpadding="0" cellspacing="0" class="tawid">
	<tr bgcolor="#f5f5f5">
		<td width="3%">ID</td>
		<td width="8%">标签名称</td>
		<td width="8%">标签分类</td>
		<td width="15%">关联</td>
		<td width="5%">是否有效</td>
		<td width="5%">数量</td>
		<td width="10%">操作</td>
	</tr>
	<volist name="taglist" id="tlist" key="k">
	<tr>
		<td>{$tlist.tagid}</td>
		<td>{$tlist.tagname}</td>
		<td>{$tlist.tagmsg}</td>
		<td>
			<switch name="tlist.tagcategory">
				<case value="11">
					<a href="{:U('Product/brandList',array('pid'=>$tlist['sid']))}" title="查看该品牌详细资料">{$tlist.relevance}</a>
				</case>
				<case value="12">
					<a href="{:U('Category/add',array('ctype'=>1))}" title="查看该产品分类详细资料">{$tlist.relevance}</a>
				</case>
				<case value="13">
					<a href="{:U('Product/index',array('pid'=>$tlist['sid']))}" title="查看该产品详细资料">{$tlist.relevance}</a>
				</case>
				<case value="14">
					<a href="{:U('Category/add',array('ctype'=>2))}" title="查看该产品功效详细资料">{$tlist.relevance}</a>
				</case>
			</switch>
		</td>
		<td>
			<a href="#" onclick="changestatuss(this,'{$tlist.tagid}')" title="点击修改状态">
				<if condition="$tlist.status eq 1">
						<font color="red">有效</font>
				<else/>
						无效
				</if>
			</a>
		</td>
		<td><a href="javascript:void(0)"  onclick="to_info({$tlist.tagid})">{$tlist.totalnum}</a>
		</td>
		<td>
			<a href="#" onclick="manage('{$tlist.tagid}','{$tlist.tagname}','{$tlist.tagcategory}','{$tlist.sid}','{$tlist.status}');return false;">管理</a>/
			<a href="{:U('TagManagement/participleLibrary',array('dele'=>$tlist['tagid']))}" style="color:#FF0000">删除</a>
		</td>
	</tr>
</volist>
<if condition="$taglist neq ''">
<tr><td colspan="10" class="datalist">{$page}</td></tr>
<else />
<tr><td colspan="10" class="valnull">抱歉,没有查询到您搜索的信息,请检查!</td></tr>
</if>
</table>
<script>
function to_info(tagid){
	$.dialog({
		title:"tag详情",
		content:"url:__URL__/tagRelationList/tagid/"+tagid,
		width:"700px"
	})
	return false;
}
function manage(id,name,cate,sid,status){
	var  $str='';
	$str='<form action="__ACTION__">';
	$str+='标签名称:<input type="text" name="tname" value="'+name+'"><br>';
	$str+='关联ID:<input type="text" name="reid" value="'+sid+'"><br>';

	$str+='标签分类:<select name="ttype">';

	if(cate == 11 ){
		$str+="<option value='11' selected>产品品牌</option>";
	}else{
		$str+="<option value='11'>产品品牌</option>";
	}

	if(cate == 12 ){
		$str+="<option value='12' selected>产品分类</option>";
	}else{
		$str+="<option value='12'>产品分类</option>";
	}

	if(cate == 13 ){
		$str+="<option value='13' selected>产品名称</option>";
	}else{
		$str+="<option value='13'>产品名称</option>";
	}

	if(cate == 14 ){
		$str+="<option value='14' selected>产品功效</option>";
	}else{
		$str+="<option value='14'>产品功效</option>";
	}

	$str+='</select><br/>';

	$str += "标签是否有效:<select name='status'>";

	if(status==1){
		$str +="<option value='1' selected>有效</option>";
		$str +="<option value='0'>无效</option>";
	}else{
		$str +="<option value='0' selected>无效</option>";
		$str +="<option value='1'>有效</option>";
	}

	$str +="</select>";

	$.dialog({
		title:'',
		content: $str,
		ok:function(){
			var tname=$(":text[name='tname']").val(),
			reid=$(":text[name='reid']").val(),
			ttype=$("select[name='ttype']").val(),
			status = $("select[name='status']").val();

			$.ajax({
				url:"__ACTION__",
				type:"post",
				dataType:"json",
				data:"tid="+id+"&tname="+tname+"&reid="+reid+"&ttype="+ttype+"&status="+status,

				success: function(chkresult){
					if(parseInt(chkresult.status)==1){
						alert(chkresult.info);
						location.reload();
					}
				}
			})
		},
		cancel: true
	});
}
		function changestatuss(obj,tagid){
			if(confirm("确定修改该标签的状态么?")){
				var status = '',tt =  $(obj).text().trim();

				if(tt == '无效'){
					status = 1;
				}else{
					status = 0;
				}
				
				$.ajax({
					url:"__ACTION__",
					type:"post",
					dataType:"json",
					data:"changestatus=true&tagid="+tagid+"&status="+status,

					success: function(chkresult){
						if(parseInt(chkresult.status)==1){
							alert(chkresult.info);
							location.reload();
						}
					}
				})
			}
		}
</script>
<include file="Public:footer" /> 