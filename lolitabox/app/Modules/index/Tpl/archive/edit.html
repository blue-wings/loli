
<!--右边content-start-->
<div class="f780 dy_wrap r">
<div class="dy_tab">
    <div class="tab">
        <div class="tad_li cfl">
            <a href="#!myarchive" class="select"><p><span class="txt">萝莉档案</span><span class="on_bg"></span></p></a>
            <a href="javascript:;"><p><span class="txt">订阅设置</span><span class="on_bg"></span></p></a>
            <a href="javascript:;"><p><span class="txt">修改密码</span><span class="on_bg"></span></p></a>
            <a href="#!deliveryAddress"><p><span class="txt">收货地址</span><span class="on_bg"></span></p></a>
            <!--<a href="javascript:;"><p><span class="txt">我的积分</span><span class="on_bg"></span></p></a>-->
            <!--<a href="javascript:;"><p><span class="txt">账户余额</span><span class="on_bg"></span></p></a>-->
            <!--<a href="javascript:;"><p><span class="txt">我的邀请</span><span class="on_bg"></span></p></a>-->

        </div>
    </div>
</div>

<div class="wp780 dy_con" id="dy_con">
    <div class="hd">&nbsp;</div>
    <div class="con">
        <!--内容--->
        <div class="My_Acc">
            <div class="harder">
                <div id="Harder_Info">
                    <font>个人信息</font>
                </div>
                <div id="Harder_Edit">
                    <a href="javascript:void(0);" id="submitUserArchive">
                        <font>确认编辑</font>
                    </a>
                </div>
                <div class="clear"></div>
            </div>
            <form action="<{:U('archive/update')}>" method="POST" id="userArchiveForm">
            <input type="hidden" name="userid" value="<{$userinfo.userid}>" >
            <div class="UserInfo">
                <div id="UserIcon">
                    <div id="UserIconBorder">
                        <img src="<{$userinfo.userface}>" width="107" height="107" />
                    </div>
                    <div id="UserIconUrl">
                        <a href="#"><font>修改头像</font></a>
                    </div>
                </div>
                <div id="UserMsg">
                    <ul class="MsgLi">
                        <li>
                            <label>呢 &nbsp;&nbsp;&nbsp;&nbsp;  称：</label><font><{$Think.cookie.nickname}></font>
                        </li>
                        <li>
                            <label>性 &nbsp;&nbsp;&nbsp;&nbsp;  别：</label>
                            <font>
                                <select name="sex">
                                    <option value="-1"  <if condition="$userinfo.sex eq -1"> selected </if> >漂亮MM</option>
                                    <option value="1" <if condition="$userinfo.sex eq 1"> selected </if>>帅锅</option>
                                </select>
                            </font>
                        </li>
                        <li>
                            <label>生 &nbsp;&nbsp;&nbsp;&nbsp;  日：</label>
                            <font>
                                <input type="date" value="<{$userinfo.years}>-<{$userinfo.months}>-<{$userinfo.days}>" placeholder="年/月/日"/>
                            </font>
                        </li>
                        <li>
                            <label>职业状态：</label>
                            <font>
                                <select>
                                    <option value="">在校学生</option>
                                    <option value="">工作...</option>
                                </select>
                            </font>
                        </li>
                        <li>
                            <label>学 &nbsp;&nbsp;&nbsp;&nbsp;  历：</label>
                            <font>
                                <select>
                                    <option value="">本科</option>
                                    <option value="">专科</option>
                                </select>
                            </font>
                        </li>
                        <li>
                            <label>手机号码：</label>
                            <font>
                                <input type="text" name="telphone" value="<{$userinfo.telphone}>" placeholder="手机号码"/>
                            </font>
                        </li>
                        <li>
                            <select name="province" id="area-province" >
                                <volist name="provinces" id="prov">
                                    <option value="<{$prov.title}>"  area-id="<{$prov.area_id}>" ><{$prov.title}></option>
                                </volist>

                            </select>
                            <select name="city" id="area-city">
                            </select>

                        </li>
                        <li>
                            <label>E&nbsp;m&nbsp;a&nbsp;i&nbsp;l：</label>
                            <font>
                                <input type="email" name="email" value="<{$userinfo.email}>" placeholder="Email" />
                            </font>
                        </li>
                    </ul>
                </div>
                <div class="clear"></div>

            </div>

            <div class="harder">
                <div id="Harder_Info">
                    <font>个人肤质及订阅信息</font>
                </div>

                <div class="clear"></div>
            </div>

            <div class="SkinInfo">

                <div class="Skin">
                    <div class="SkinHander">
                        <label>肤 质:</label>
                        <font>
                            <select name="skin_property">
                                <option value="混合性皮肤">混合性皮肤</option>
                            </select>
                        </font>
                    </div>
                    <div class="SkinHander">
                        <label>肤 色：</label>
                        <font>
                            <select>
                                <option value="">黑珍珠</option>
                            </select>
                        </font>
                    </div>
                    <div class="SkinHander">
                        <label>发 质：</label>
                        <font>
                            <select name="hair_property">
                                <option value="油性发质">油性发质</option>
                            </select>
                        </font>
                    </div>
                    <div class="clear"></div>
                </div>

                <ul class="SkinLi">
                    <volist name="properties" id="property">
                        <li>
                            <i class="edit_archive">&nbsp; &nbsp;</i><label> <{$property.property_name}>：</label><font id="property_value_names_<{$property.property_id}>"><{$property.checked_values}></font>
                            <div class="Edit_Save save_hide_div" style="display: none;" property_id="<{$property.property_id}>"><a href="javascript:void(0);" >确定</a></div>
                            <ul style="display: none;">
                                <volist name="property.values" id="value">
                                    <if condition="$property.type eq checkbox">
                                        <li><input type="checkbox" value="<{$value.value_id}>" name="input-<{$property.property_id}>" <if condition="$value.checked eq true"> checked </if>  /><label><{$value.value_name}></label></li>
                                    </if>
                                    <if condition="$property.type eq radio">
                                        <li><input type="radio" value="<{$value.value_id}>" name="input-<{$property.property_id}>" <if condition="$value.checked eq true"> checked </if>  /><label><{$value.value_name}></label></li>
                                    </if>
                                </volist>
                                <div class="clear"></div>
                            </ul>

                        </li>
                    </volist>
                </ul>

            </div>
        </form>

        </div>


        <!--内容-END-->
    </div>
    <div class="ft">&nbsp;</div>
</div>
</div>

<script type="text/javascript" src="public/js/ellipsisSizeH.js"></script>
<!--<script type="text/javascript" src="public/js/gzJs.js"></script>-->
<script src="public/js/jquery.masonry.min.js" type="text/javascript"></script>
<script src="public/js/jquery.lazyload.js"></script>
<script>
    $(function () {
        $("img[data-original]").lazyload({ threshold: 200, effect: "fadeIn" });
        /**
         *高度一致
         */
        var r_h = $(".f780"),
                l_h = $('.side');
        if(r_h && l_h){
            l_h.css({"height":r_h.height()+"px"}) ;
        }

        /**
         *我的订阅
         *产品描述浮层的显示与隐藏
         */
        var dy_li = $(".dy_li"),
                dy_txt = dy_li.find('.txt');
        if(dy_li && dy_txt){
            dy_li.hover(function(){
                $(".txt",this).show();
                $(".name",this).hide();
                //描述内容超出三行显示省略号，依赖ellipsisSizeH.js
                var row = $(".tip_xz");
                for (var i = 0; i < row.length;i++) {
                    $(row)[i].ellipsisSizeH(3);//超出高度显示省略号
                };
            },function(){
                $(".txt",this).hide();
                $(".name",this).show();
            })
        }

        $("#submitUserArchive").on("click",function(){
            $("#userArchiveForm").submit();
        });
        $(".save_hide_div").on("click",function(){
            var me = $(this);
            me.hide();
            me.next().hide();
            me.parent().removeClass("Edit");
            var propertyId = me.attr('property_id');
            var params = "property_id="+propertyId;
            var inputs = $("input[name=input-"+ propertyId+"]:checked");
            var values = ""
            $.each(inputs,function(index,e){
                if(values.length > 0){
                    values=values + ','+ $(this).val();
                }else{
                    values= $(this).val();
                }

            });
            params += '&value_ids=' + values;
            $.ajax({
                url:"__URL__/updateUserArchive",
                type:"post",
                dataType:"json",
                data:params,
                success: function(result){
                    if(parseInt(result.status)==1){
                        $("#property_value_names_"+propertyId).text(result.data)
                    }else{
                        alert("删除失败!");
                    }
                }
            });

        });
        $(".edit_archive").on("click",function(){
            var me = $(this);
            if(me.parent().hasClass("Edit")){
                me.parent().removeClass("Edit");
            }else{
                me.parent().addClass("Edit");
            }

            me.nextAll('ul').toggle();
            me.nextAll('div').toggle();
        });
        $("#area-province").on('change',function(){
            var option = $("#area-province > option:selected");
            $.ajax({
                url:"__URL__/getCity",
                type:"post",
                dataType:"json",
                data:"&province_id="+option.attr('area-id'),
                success: function(result){
                    var city = $("#area-city");
                    city.empty();
                    $.each(result.data,function(index,area){
                        var c = ("<option value='"+area.title+"'>"+area.title+"</option>")
                        city.append(c);
                    });
                }
            });
        });
    });
</script>

