<iframe name="hidden_frame" id="hidden_frame" style="display:none" ></iframe>

<div class="tc_seeDialogue_wrap" style="width:750px;">
	<div class="tc_send_disc">
    	<div class="title_area cfl">
			<div class="title"><h2>
			<if condition="$Think.post.type eq 4 OR $return.type eq 4">
			发表收到“<{$return['name']}>”的感想
			<elseif condition="$Think.post.type eq 1 OR $return.type eq 1" />
			发表“<{$return['name']}>”的试用分享
			<else />
				发表分享
			</if>
			
			
			
			</h2>
			</div>
            <div class="title_r">精彩分享将获得<{$return[share_score]}>积分奖励</div>
		</div>	
		<div class="send_weibo cfl">
		
		<notempty name="return[veiw_account]">
            <div class="select_test">
                <div class="select_test_title">选择我赞同的试用观点  <!--a href="javascript:void(0);">　<span class="all_con">[+展开更多观点]</span></a--></div>
                <div class="select_test_con">
					<volist name="return[veiw_account]" id="vo">
					<label for="veiw_account_<{$i}>">
					<input type="radio" name="veiw_account" value="<{$vo}>" id="veiw_account_<{$i}>"/><span><{$vo}></span>
                    </label>
                      </volist>
                </div>
            </div>		
		</notempty>
		
		
			<div class="input cfl edit_div">输入你的分享内容　　<br/>
				<textarea class="input_detail" id="sendReview_dialog" style="width:707px;height:300px"><notempty name="return.content"><{$return.content}></notempty></textarea>
				<input type="hidden"  value="<{$Think.post.type|default=1}>"  name="resourcetype">
				<input type="hidden"  value="<{$Think.post.pid}>"  name="resourceid">
				<input type="hidden" name="if_sina" id="if_sina" value="<{$bind['sina']}>"/>
				<input type="hidden" name="if_qq" id="if_qq" value="<{$bind['qq']}>"/>
			    <input type="hidden"  name="shareid"  value="<{$Think.post.shareid}>" />
			</div>
							
			<div class="func_area cfl">
				<div class="func">
					<a href="javascript:void(0)">
						<ul class="share_custom cfl">
						        <li>
							    <label for="share_sina">
											<input type="checkbox" name="share_sina" id="share_sina" <if condition="$bind['sina'] eq 1">checked="checked"</if> class="share_checksinabox" />
											<b title="分享到新浪微博" class="i_sina"  href="javascript:void(0);"></b>新浪微博
										</label>
								</li>
								<li>
										<label for="share_qq">
											<input type="checkbox" id="share_qq" name="share_qq"  <if condition="$bind['qq'] eq 1">checked="checked"</if> class="share_checkqqbox"/>
											<b title="分享到腾讯微博" class="i_qqweibo" href="javascript:void(0);"></b>腾讯微博
										</label>
							  </li> 
						</ul>
					</a>
					<span id="share_toshare">
								<a class="W_pin_b" id="write_share">
									<span>发表</span>
								</a>
					</span>
					<span id="share_inshare" style="display:none;">
								<a class="W_pin_grey">
									<span>发表中...</span>
								</a>
					</span>
				</div>
				
			</div>
		</div>
	</div>
	<input type="hidden" id="point" value="<{$point}>" />
	<div style="display:none;" id="dialog_msg4">上传“<{$return['name']}>“的美照，再把你收到盒子的感想、对盒子的评价、对产品的感受通通写出来吧！不要吝啬你的文字哦~</div>
	<div style="display:none;" id="dialog_msg1">尽情表达你对“<{$return['name']}>“的评价、试用心得以及试用理由吧！好评批评照单全收！最好给产品拍个美照传上来哦~</div>
	<input type="hidden" name="sharetype" id="sharetype" value="2" />
</div>
<script src="/public/js/lolitaboxFace.js"></script>

<script type="text/javascript">
var editor;
var options = {
		items:['image'],
		filterMode : true,
		minHeight:"210",
		minWidth:"718",
		uploadJson : "<{:U('public/kindeditor_upload_json')}>"
	};

function to_editor(){
	$.getScript('public/kindeditor/kindeditor-min.js', function() {
		editor=KindEditor.create('#sendReview_dialog',options);
	});
	$(".edit_div").css({"height":"320px"});
	$("#sharetype").val(2);
}
to_editor();
/* function to_cancel_e(){
	KindEditor.remove('#sendReview_dialog');
	$("#sharetype").val(0);
	$("#editor_2").hide();
	$("#editor_1").show();
	$(".kind_detail").show();
} */


$('.all_con').bind('click',function(){
	if($('.select_test_con').height()<=18){
	   $('.select_test_con').css({height:'auto'})
	   $('.select_test_title').find('.all_con').html('[-展开更多观点]');
    }else if($('.select_test_con').height()>18){
		$('.select_test_con').css({height:'18px'});
		$('.select_test_title').find('.all_con').html('[+展开更多观点]');
	}
})	;
	 
$(function(){
	$('.emotion').qqFace({
		assign:'sendReview_dialog', //给那个控件赋值
		path:'public/lolitabox/smilies/'	//表情存放的路径
	});

//监听	
	$("#sendReview_dialog").bind({
		focus:function(){
			if($(this).val()==msg4 || $(this).val()==msg1){
				$(this).val("");
			}
		},
		keydown:function(e){
			e = e?e:window.event;
			if(e.ctrlKey && 13==e.keyCode){
				$("#write_share").click();
			}
		}
	})
})
</script>
<script>
var msg4=$("#dialog_msg4").html();
var msg1=$("#dialog_msg1").html();

function previewImage()
{
	$("#imgform").submit();
}
function close_pic(){
	var id="sharePicDialog";
	$("#file_pic").val("");
	$("#"+id).hide();
	$("#imgSharePicDialog").val("");
	$("#imgpathDialog").val("");
}

$("#write_share").click(function(){
	var sharetype=$("#sharetype").val();
	if(sharetype==2){
		var share_info=editor.html();
	}else{
		var share_info=$.trim($("#sendReview_dialog").val());
	}
	//alert(share_info);return false;
	var point=$("input[name='veiw_account']:checked").val();
	if(point==undefined){
		var point="";
	}
	if(share_info=="如果是分享关于产品/品牌的心得，记得@产品/品牌的名称哦~" || share_info==msg1 || share_info==msg4){
		share_info="";
	}
	if((share_info=="" || share_info=="如果是分享关于产品/品牌的心得，记得@产品/品牌的名称哦~" || share_info==msg1 || share_info==msg4) && point==""){
		n_dialog("<p>亲爱的，你要告诉我们你的使用感受才能发表哦……</p><p>记得同步发送到微博让更多好友知道你的美丽新宠。</p>",5);
		return false;
	}	

	var param = {};
	var url="";
	var imgpath=$("#imgpathDialog").val();
	var shareid=$("input[name='shareid']").val();
	var sina_type=$("#share_sina").attr("checked")?$("#if_sina").val():0;
	var qq_type=$("#share_qq").attr("checked")?$("#if_qq").val():0;	
	
	if(shareid){
		url="<{:u('home/edit_share')}>"
		param = {share_info:share_info,imgpath:imgpath,sina_type:sina_type,qq_type:qq_type,shareid:shareid,sharetype:sharetype};
	}else{
		var resourceid =  $("input[name='resourceid']").val(); 
		var resourcetype = $("input[name='resourcetype']").val();
		param = {share_info:share_info,imgpath:imgpath,resourceid:resourceid,resourcetype:resourcetype,sina_type:sina_type,qq_type:qq_type,point:point,sharetype:sharetype};
		url = "<{:u('home/write_share')}>";
	}
	$("#share_toshare").hide();
	$("#share_inshare").show();
	var flag = 0;
	   $.ajax({
			url:url,
			type:"post",
			dataType:"json",
			data:param,
			success:function(ret){
				if(ret.status==1){
					if(!shareid){
						if(resourcetype==4){
							var num=50;
						}else{
							var num=10;
						}
						var content="发表成功<p>我们会在2个工作日内进行审核</p><p>通过审核的分享即可获得"+num+"积分奖励哦~";
						y_dialog(content,3,function(){
							share_dialog.close();
						});
						postshare_third(ret.info,sina_type,qq_type,point,share_info);
					}else{
						y_dialog("修改成功",2,function(){
							share_dialog.close();
							location.reload();
						});
					}
				}else if(parseInt(ret.status)==-1){
	 				$("#share_toshare").show();
					$("#share_inshare").hide(); 
					alert("您发表的分享中包含敏感关键词："+ret.data+"，您需要修改后才能发表哦~");
				}else{
					$("#share_toshare").show();
					$("#share_inshare").hide(); 
					n_dialog(ret.info,2);
				}
			}
		});
})


function postshare_third(id,sina,qq,point,content){
   $.ajax({
		url:"<{:u('home/post_share_tothird')}>",
		type:"post",
		dataType:"json",
		data:{id:id,sina_type:sina,qq_type:qq,point:point,content:content},
		success:function(ret){}	
		})
}

$(function(){
	var TextReview =  $('.send_weibo .input_detail');
	TextReview.focus(function(){
		$(this).closest('.send_weibo').addClass('send_weibo_focus');
	})
	TextReview.blur(function(){
		$(this).closest('.send_weibo').removeClass('send_weibo_focus')
	})

})

function imgload(img){
	$("#imgSharePicDialog").attr("src",img);
	$("#imgpathDialog").val(img);
	$("#fileTuDialog").val("");
	$("#sharePicDialog").css("display","block");
}

$(".share_checksinabox").click(function(){
	if(document.getElementById("share_sina").checked==false){
		$("#if_sina").val(0);
	}else{
		user_ifbind();
		if($("#if_sina").val()!=1){
			if($("#if_sina").val()==0){
				window.open("/user/sina_lock.html");
			}else{
				window.open("/user/sina_login.html");
			}
			document.getElementById("share_sina").checked=false;
		}
	}
})


$(".share_checkqqbox").click(function(){
	if(document.getElementById("share_qq").checked==false){
		$("#if_qq").val(0);
	}else{
		user_ifbind();
		if($("#if_qq").val()!=1){
			if($("#if_qq").val()==0){
				window.open("/user/qq_lock.html");
			}else{
				window.open("/user/qq_login.html");
			}
			document.getElementById("share_qq").checked=false;
		}
	}
})

function user_ifbind(){
	$.ajax({
		url:"<{:u('home/user_if_bind')}>",
		type:"post",
		dataType:"json",
		async:false,
		success:function(ret){
			if(parseInt(ret.status)==1){
					$("#if_sina").val(ret.info.sina);
					$("#if_qq").val(ret.info.qq);
			}
		}
	})
}


</script>

