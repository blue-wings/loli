<include file="public:header.inc" />
<!--公用---头部--end------->

<!--分页--start-->
<div class="fm1020 top_guide">
	所在位置：<a href="/">网站首页</a> > <a href="<{:u('home/index')}>">个人主页</a> > <span class="g9">基本信息</span></a>
</div>
<!--分页--end-->

<!--个人中心--内容--start-------->
<div class="fm1020_b cfl">
	<!--左侧导航--->
	<include file="left.inc" />
	
	
	<!--右侧-内容-->
	<div class="f738 r wp738">
		<!--分享详情页内容-->
		
		<include file="info.inc" />
		<div class="main My_details_wrap">
			<div class="pl_content_orders">
				<!----内容--->
				<i class="hei1 mb16"></i>
				<div class="user_message">
				<form name="frm" method="POST" >
					<dl class="login-dl cfl">
					<if condition="$return[userinfo]['password'] neq ''" >
						<dt class="dt_l">注册邮箱：</dt>
						<dd class="dd_r g9"><{$return[userinfo]['usermail']}> 
						     <if condition="$return[userinfo]['state'] neq '2'" >
									<a href="<{:U("user/send_reactive_mail",array("userid"=>$return[userinfo]['userid']))}>" class="W_pin_b">验证邮件得积分</a>
							<else/>
									<a class="W_pin_grey"  href="javascript:void(0)">已验证</a>
							</if>							
						</dd>
				 </if>
						<dt class="dt_l">昵称：</dt>
						<dd class="dd_r g9"><{$return[userinfo]['nickname']}></dd>						
						<dt class="dt_l">性别：</dt>
						<dd class="dd_r g9">
						    <span class="sex_f"> <label for="d_boy" name="d_boy"><input id="d_boy" name="sex" type="radio" value="0" checked="checked"/><b class="people_ico woman"></b>妹纸</label></span>
							<span class="sex_f"><label for="d_woman" name="d_woman"><input type="radio" name="sex" value="1" id="d_woman"/><b class="people_ico man"></b>帅锅</label></span>
							<!-- <span class="sex_f"> <label for="d_boy" name="d_boy"><input id="d_boy" name="sexF" type="radio" checked="checked"><b class="people_ico woman"></b>妹纸</label></span>
							<span class="sex_f"><label for="d_woman" name="d_woman"><input type="radio" name="sexF" id="d_woman"><b class="people_ico man"></b>帅锅</label></span> -->
						</dd>
						<dt class="dt_l">生日：</dt>
						<dd class="dd_r g9">
							<div class="user_select_wrap">
								<select id="year" name="year"  class="selectInput"  onChange="return CheckDay();">
								 <{$return.yearlist}></select>                                 
								<select name="month" id="month" class="selectInput"  onChange="return CheckDay();">
									<for start="1" end="13">
								    	<option  value="<{$i}>" <eq name="return.userinfo.months"  value="$i">selected</eq>><{$i}>
								  </option>
								   </for>
								</select>
								<select name="day"  id="day"  class="selectInput"  onchange="return sendf();">
								</select>

								
							</div>
						</dd>
						<dt class="dt_l">星座：</dt>
						<dd class="dd_r g9">
						    <span class="sign_img"><img src="public/images/groupavatar/120218.jpg" width="30" height="30"  id="coning"/></span><span id="constellation">摩羯座</span>
						</dd>
						<dt class="dt_l">所在地：</dt>
						<dd class="dd_r g9">
							<div class="user_select_wrap"  id="myarea">
							    	<select class="prov selectInput" id="s1" name="province"></select> 
									<select class="city selectInput" id="s2" name="city" disabled="disabled"></select> 
									<select class="dist selectInput" id="s3" name="district" disabled="disabled">
									</select>						
							</div>
						</dd>
						
						<dt class="dt_l">手机号：</dt>
						<dd class="dd_r g9">
							<div class="user_phone">
							    <input type="text" maxlength="11"  type="text" id="telphone"  value="<{$return.userinfo.telphone|default='请输入您的手机号'}>" <eq name="return.userinfo.tel_status" value="1">readonly</eq> />
								<if condition="$return[userinfo][tel_status] eq 1">
									<a class="W_pin_grey">已验证</a>
								<else />
								    <p class="l lh22 mr5 ml5 f12 g9"></p>
									<a href="<{:u('task/index',array('id'=>3))}>" target="_blank" class="W_pin_b">验证手机得积分</a>
								</if>
							</div>
						</dd>
						<dt class="dt_l">学历：</dt>
						<dd class="dd_r g9">
						<div class="user_select_wrap">
						    	<select id="edu" class="selectInput" name="edu">
									<option value="0" <if condition="$return[userinfo]['edu'] eq 0"> selected </if> >请选择</option>
									<option value="1" <if condition="$return[userinfo]['edu'] eq 1"> selected </if> >高中</option>
									<option value="2" <if condition="$return[userinfo]['edu'] eq 2"> selected </if> >大专</option>
									<option value="3" <if condition="$return[userinfo]['edu'] eq 3 OR $return[userinfo]['edu'] eq ''">selected</if>>本科</option>
									<option value="4" <if condition="$return[userinfo]['edu'] eq 4"> selected </if>>硕士</option>
									<option value="5" <if condition="$return[userinfo]['edu'] eq 5"> selected </if>>博士</option>
									<option value="6" <if condition="$return[userinfo]['edu'] eq 6"> selected </if>>其它</option>
							  </select>
						</div>	
						</dd>
						
						<dt class="dt_l">肤质：</dt>
						<dd class="dd_r g9">
						<div class="user_select_wrap">
							<select id="skin" class="selectInput" name="skin">
										<option value="请选择">请选择</option>
										<option value="中性皮肤">中性皮肤</option>
										<option value="油性皮肤">油性皮肤</option>
										<option value="干性皮肤">干性皮肤</option>
										<option value="混合性皮肤">混合性皮肤</option>
										<option value="敏感性皮肤">敏感性皮肤</option>
							</select>
						</div>	
						</dd>
						
						<dt class="dt_l">发质：</dt>
						<dd class="dd_r g9">
						<div class="user_select_wrap">
						     <select id="hair" class="selectInput" name="hair">
						                <option value="请选择">请选择</option>
										<option value="受损发质">受损发质</option>
										<option value="干枯发质">干枯发质</option>
										<option value="油性发质">油性发质</option>
										<option value="中性发质">中性发质</option>
						     </select>
						     <script>$("#hair").val('<{$return.userinfo.hair_property}>')</script>
						</div>	
						</dd>
						
						<dt class="dt_l">职业：</dt>
						<dd class="dd_r">
						<div class="user_select_wrap">
							<select id="professional" class="selectInput" name="professional">
							            <option value="请选择">请选择</option>
										<option value="时尚白领">时尚白领</option>
										<option value="在校学生">在校学生</option>
										<option value="公务员">公务员</option>
										<option value="企业主">企业主</option>
										<option value="互联网人">互联网人</option>
										<option value="市场/PR/广告">市场/PR/广告</option>
										<option value="编辑/记者">编辑/记者</option>
										<option value="传媒/娱乐">传媒/娱乐</option>
										<option value="化妆/造型">化妆/造型</option>
										 <option value="摄影师">摄影师</option>
										<option value="设计师">设计师</option>
										<option value="艺术家">艺术家</option>
										<option value="家庭主妇">家庭主妇</option>
										<option value="金融/保险">金融/保险</option>
										<option value="自由职业者">自由职业者</option>
										<option value="其他">其他</option>
										
					        </select>	
					        <script>
					              $("#professional").val('<{$return[userinfo].profession}>')
					        </script>	
						</div>	
						</dd>
						<dt class="dt_l">简介：</dt>
						<dd class="dd_r dd_abstract">
							<textarea maxlength="140"  id='introduction' name="description" class="user_abstract"><{$return[userinfo].description}></textarea>
							<span class="g9" ><span id="show_text_num"><script>var a=$("#introduction").val();document.write(140-a.length);</script></span>/140</span>
						
						</dd>
					</dl>
				</form>
				</div>
				
				<div class="user_message_cont">
					<div class="user_mes">
						<a href="javascript:void(0)" id="subm" class="W_pin_b14">保存</a>
					</div>
				</div>
				<i class="hei1"></i>
			</div>
		</div>
		<div class="ft"></div>
	</div>
</div>
<script type="text/javascript" src="public/area/jquery.cityselect.js"></script>
<script>
function user_check_tel(){
	telphone=$.trim($("#telphone").val());
	var reg0=/^1[3|4|5|8][0-9]\d{8}$/;
	if(!(reg0.test(telphone))){
		alert('请输入正确的手机号!');
		return false;
	}
	$.ajax({
		url:"<{:u('home/send_tel_code')}>",
		type:"post",
		dataType:"json",
		data:{tel:telphone},
		success:function(ret){
			if(parseInt(ret.status)==1){
				$.dialog({content:"恭喜您，修改成功",time:2,icon: 'succeed'});
			}else{
				if(parseInt(ret.data)==100){
					alert("30分钟内不可重复操作");
				}else if(parseInt(ret.data)==200){
					alert("手机号已绑定过，不能再次绑定");
				}else if(parseInt(ret.data)==300){
					alert("已绑定，请勿重复操作");
				}else{
					alert(ret.info);
				}
			}
		}
	})
}

function to_check(){
	var code=$.trim($("#tel_bind").val());
	if(code==""){
		alert("请输入验证码");
		return false;
	}
	$.ajax({
		url:"<{:u('home/check_tel_code')}>",
		type:"post",
		dataType:"json",
		data:{code:code},
		success:function(ret){
			if(parseInt(ret.status)==1){
				alert("验证成功");
			}else{
				if(parseInt(ret.data)==100){
					alert("验证信息不存在");
				}else if(parseInt(ret.data)==101){
					alert("已验证，请勿重复操作");
				}else if(parseInt(ret.data)==102){
					alert("验证码已过期，您可以重新获取");
				}else{
					alert(ret.info);
				}
			}			
		}		
	})
}




$(function(){
	if('<{$return[userinfo].province}>' == '' || '<{$return[userinfo].city}>' == '' || '<{$return[userinfo].district}>' == ''){
		set_area('北京市','北京市','东城区');
	}else{
		set_area('<{$return[userinfo].province}>','<{$return[userinfo].city}>','<{$return[userinfo].district}>');
	}
})


$("#telphone").focus(function(){
		if($(this).val()=='请输入您的手机号'){
			$(this).val('');
		}
})

function CheckDay(){    
	var nowDay  = <{$return[userinfo]['days']}>;
    var   YearNo,MonthNo,DayNo;   
    YearNo  =  $("#year").val();  
    MonthNo =  $("#month").val();

    var   i,j,DayCount;     
    if(MonthNo==1 || MonthNo==3 || MonthNo==5 || MonthNo==7 || MonthNo==8 || MonthNo==10 || MonthNo==12)  {
		DayCount = 31;
	}   
    if(MonthNo==4 || MonthNo==6 || MonthNo==9 || MonthNo==11 ){
		DayCount = 30;
	}   
    if(MonthNo==2){   
	   if(IsRunY(YearNo)){
		   DayCount = 29;
	   }else{
		   DayCount = 28;
	   }   
    } 

    document.frm.day.length=DayCount;	
    for (i=0;i<=DayCount-1;i++) {   
       document.frm.day[i]=new Option(i+1);     
       document.frm.day[i].value=i+1; 
	   if(nowDay==document.frm.day[i].value){
			document.frm.day[i].selected = true;
	   }
    }   
    sendf();
}

function IsRunY(YearNo) { 
    if ((YearNo % 4 == 0 && YearNo % 100 != 0) || YearNo % 400 == 0){
        return true;
    }else{
        return false;
    }
}

var nowPro='<{$return[userinfo]['province']}>';	
var nowCity='<{$return[userinfo]['city']}>';
var nowDistrict='<{$return[userinfo]['district']}>';

CheckDay();

Array.prototype.in_array = function(e)
{
for(i=0;i<this.length && this[i]!=e;i++);
return !(i==this.length);
}

function sendf(){
		var mon=$("#month").val();
	 	var day=$("#day").val();	
	
		$.ajax({
		url:"<{:u('home/constellation')}>",
		type:"post",
		dataType:"json",
		data:"month="+mon+"&day="+day,
		success: function(chkresult){
				if(parseInt(chkresult.status)==1){
					
					$("#constellation").text(chkresult.info);
					$("#coning").attr("src","public/images/groupavatar/"+chkresult.data);
				}
			}
		})
}

sendf();

$(function(){
$("select[name='skin'] option[value='<{$return[userinfo].skin_property}>']").attr('selected',true);

$(":radio[name='sex'][value='"+"<{$return[userinfo].sex}>"+"']").attr("checked",true);


	$("#subm").bind('click',function(){
		var sex=$(":radio[name=sex][checked]").val();
		var year=$("#year").val();
		var month=$("#month").val();
		var day=$("#day").val();
		var province=$("#s1").val();
		var city=$("#s2").val();		
		var district=$("#s3").val();
		var edu=$("#edu").val();
		var skin=$("#skin").val();
		var hair=$("#hair").val();
		var telphone = $("#telphone").val();
		var professional=$("#professional").val();
		var introduction=$("#introduction").val();
		var reg0=/^1[3|4|5|8][0-9]\d{8}$/;

		if(sex==''){alert('请选择性别')}
		else if(year=='请选择'||month=='请选择'||day=='请选择'){alert('请选择年月日')}
		else if(province=='请选择'||city=='请选择'||district=='请选择'){alert('请选择省市区')}	
		else if(!(reg0.test(telphone))){alert('请输入正确的手机号!')}
		else if(edu==0){alert('请选择学历')}
		else if(skin=='请选择'){alert('请选择肤质')}
		else if(hair=='请选择'){alert('请选择发质')}
		else if(professional=='请选择'){alert('请选择您的职业')}
		else if(introduction==''){alert('请填写您的简介')}
		else{
			$.ajax({
				url:"<{:u('home/information')}>",
				type:"post",
				dataType:"json",
				data:"sex="+sex+"&telphone="+telphone+"&year="+year+"&month="+month+"&day="+day+"&province="+province+"&city="+city+"&district="+district+"&edu="+edu+"&skin="+skin+"&hair="+hair+"&professional="+professional+"&introduction="+introduction,
				success: function(chkresult){
					if(parseInt(chkresult.status)==1){
						$.dialog({content:"恭喜您，修改成功",time:2,icon: 'succeed'});
						window.setTimeout("open()",2000);		
					}
				}
			})
		}	
	})
})
function open(){
	$("#dis").hide();
}



function set_area(prov,city,dist) {
	if(prov=="" || prov=="请选择") {
		$("#myarea").citySelect({nodata:"none",required:false});	
	}
	else {
		$("#myarea").citySelect({
	    	prov:prov, 
	    	city:city,
			dist:dist
		}); 
	}
}

$(function(){
	limit_word_num("introduction","show_text_num",140);
})
</script>
<!--个人中心--内容--end-------->
<include file="public:footer.inc" />
